<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFT WeatherMorph - Live Demo</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #121212; color: #e0e0e0; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .container { max-width: 900px; padding: 40px; background-color: #1e1e1e; border-radius: 16px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3); text-align: center; }
        h1 { font-size: 2.5em; color: #ffffff; margin-bottom: 10px; }
        p { color: #b0b0b0; font-size: 1.1em; line-height: 1.6; }
        .nft-display { margin: 40px 0; background-color: #2a2a2a; border-radius: 12px; padding: 20px; }
        #nftImage { max-width: 100%; width: 400px; height: 400px; border-radius: 8px; background-color: #121212; border: 1px solid #444; }
        #nftName { font-size: 1.8em; font-weight: bold; margin-top: 20px; color: #fff; }
        #nftDescription, #nftAttribute { color: #b0b0b0; }
        #loading { font-size: 1.2em; }
        button { background-color: #007bff; color: white; border: none; padding: 12px 24px; font-size: 1em; border-radius: 8px; cursor: pointer; transition: background-color 0.3s ease; }
        button:hover { background-color: #0056b3; }
        .attributes-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 20px; }
        .attribute-card { background: #333; padding: 12px; border-radius: 8px; text-align: left; }
        .attribute-label { display: block; color: #888; font-size: 0.9em; }
        .attribute-value { display: block; color: #fff; font-weight: bold; margin-top: 4px; }
        .rarity.Legendary { color: #ff6b00; }
        .rarity.Epic { color: #a335ee; }
        .rarity.Rare { color: #0070dd; }
        .rarity.Uncommon { color: #1eff00; }
        .rarity.Common { color: #ffffff; }
    </style>
</head>
<body>
    <div class="container">
        <h1>NFT WeatherMorph</h1>
        <p>This NFT's appearance and traits change autonomously based on real-world weather data, powered by Kwala automation.</p>
        <div class="nft-display">
            <div id="loading">Loading NFT from the blockchain...</div>
            <img id="nftImage" style="display: none;" alt="WeatherMorph NFT">
            <h2 id="nftName"></h2>
            <p id="nftDescription"></p>
            
            <div id="attributes" class="attributes-grid" style="display: none;">
                <div class="attribute-card">
                    <span class="attribute-label">Weather:</span>
                    <span class="attribute-value" id="weatherCondition"></span>
                </div>
                <div class="attribute-card">
                    <span class="attribute-label">Rarity:</span>
                    <span class="attribute-value rarity" id="rarity"></span>
                </div>
                <div class="attribute-card">
                    <span class="attribute-label">Time:</span>
                    <span class="attribute-value" id="timeOfDay"></span>
                </div>
                <div class="attribute-card">
                    <span class="attribute-label">Season:</span>
                    <span class="attribute-value" id="season"></span>
                </div>
            </div>
        </div>
        <button onclick="fetchNFTData()">Refresh Data</button>
        <p>Data is pulled directly from the Polygon Amoy testnet.</p>
    </div>
    <script>
        const contractAddress = "0x4eb0297409edfab76d08db836f5ca49088d7c4ad";
        const providerUrl = "https://polygon-amoy.drpc.org";
        
        const contractABI = ["function tokenURI(uint256 tokenId) view returns (string)"];

        const nftImageElem = document.getElementById('nftImage');
        const nftNameElem = document.getElementById('nftName');
        const nftDescElem = document.getElementById('nftDescription');
        const nftAttrElem = document.getElementById('nftAttribute');
        const loadingElem = document.getElementById('loading');

        async function fetchNFTData() {
            try {
                loadingElem.style.display = 'block'; 
                nftImageElem.style.display = 'none';
                document.getElementById('attributes').style.display = 'none';
                
                const provider = new ethers.providers.JsonRpcProvider(providerUrl);
                const contract = new ethers.Contract(contractAddress, contractABI, provider);
                const metadataUrl = await contract.tokenURI(1);
                const metadataResponse = await fetch(metadataUrl);
                const metadata = await metadataResponse.json();
                
                nftImageElem.src = metadata.image;
                nftNameElem.innerText = metadata.name;
                nftDescElem.innerText = metadata.description;
                
                if (metadata.attributes) {
                    const weatherAttr = metadata.attributes.find(a => a.trait_type === "Weather Condition");
                    const rarityAttr = metadata.attributes.find(a => a.trait_type === "Rarity");
                    const timeAttr = metadata.attributes.find(a => a.trait_type === "Time of Day");
                    const seasonAttr = metadata.attributes.find(a => a.trait_type === "Season");
                    
                    document.getElementById('weatherCondition').innerText = weatherAttr?.value || 'Unknown';
                    const rarityElem = document.getElementById('rarity');
                    rarityElem.innerText = rarityAttr?.value || 'Unknown';
                    rarityElem.className = `attribute-value rarity ${rarityAttr?.value || ''}`;
                    document.getElementById('timeOfDay').innerText = timeAttr?.value || 'Unknown';
                    document.getElementById('season').innerText = seasonAttr?.value || 'Unknown';
                    
                    document.getElementById('attributes').style.display = 'grid';
                }
                
                loadingElem.style.display = 'none'; 
                nftImageElem.style.display = 'block';
                
            } catch (error) {
                console.error("Failed to fetch NFT data:", error);
                loadingElem.innerText = "Error loading NFT. Please try again later.";
            }
        }
        window.onload = fetchNFTData;
    </script>
</body>
</html>
